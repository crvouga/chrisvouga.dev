name: chrisvouga-dev

services:
  # Portfolio Site
  # Source: https://github.com/crvouga/chrisvouga.dev
  portfolio:
    image: crvouga/portfolio:latest
    platform: linux/amd64
    container_name: portfolio
    ports:
      - "8001:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Pickflix
  # Source: https://github.com/crvouga/pickflix-v1
  pickflix:
    image: crvouga/pickflix:latest
    platform: linux/amd64
    container_name: pickflix
    environment:
      NODE_ENV: "production"
      DATABASE_URL: "noop"
      PORT: "3000"
      SECRET: "noop"
      SEND_GRID_API_KEY: "noop"
      SEND_GRID_REGISTERED_EMAIL_ADDRESS: "noop"
      SESSION_COOKIE_SECRET: "noop"
      TMDB_API_READ_ACCESS_TOKEN: "${TMDB_API_READ_ACCESS_TOKEN:-noop}"
      YOUTUBE_API_KEY: "noop"
    ports:
      - "8004:3000"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Headless Combobox Docs
  # Source: https://github.com/crvouga/headless-combobox
  headless-combobox-docs:
    image: crvouga/headless-combobox-docs:latest
    platform: linux/amd64
    container_name: headless-combobox-docs
    ports:
      - "8005:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Headless Combobox Svelte Example
  # Source: https://github.com/crvouga/headless-combobox
  headless-combobox-svelte-example:
    image: crvouga/headless-combobox-svelte-example:latest
    platform: linux/amd64
    container_name: headless-combobox-svelte-example
    ports:
      - "8006:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Moviefinder App Rust
  # Source: https://github.com/crvouga/moviefinder.app-rust
  moviefinder-app-rust:
    image: crvouga/moviefinder-app-rust:latest
    platform: linux/amd64
    container_name: moviefinder-app-rust
    environment:
      STAGE: local
      DATABASE_URL: postgresql://moviefinder-app-rust-postgres:moviefinder-app-rust-postgres@moviefinder-app-rust-postgres:5432/moviefinder-app-rust-postgres?sslmode=disable
      PORT: 80
      TMDB_API_READ_ACCESS_TOKEN: ${TMDB_API_READ_ACCESS_TOKEN:-noop}
      TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID:-noop}
      TWILIO_AUTH_TOKEN: ${TWILIO_AUTH_TOKEN:-noop}
      TWILIO_SERVICE_SID: ${TWILIO_SERVICE_SID:-noop}
    ports:
      - "8007:80"
    networks:
      - projects-network
    restart: unless-stopped
    depends_on:
      moviefinder-app-rust-postgres:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  moviefinder-app-rust-postgres:
    image: postgres:15-alpine
    container_name: moviefinder-app-rust-postgres
    environment:
      POSTGRES_DB: moviefinder-app-rust-postgres
      POSTGRES_USER: moviefinder-app-rust-postgres
      POSTGRES_PASSWORD: moviefinder-app-rust-postgres
    ports:
      - "5435:5432"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U moviefinder-app-rust-postgres -d moviefinder-app-rust-postgres"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 10s

  # Moviefinder App Go
  # Source: https://github.com/crvouga/moviefinder.app-go
  moviefinder-app-go:
    image: crvouga/moviefinder-app-go:latest
    platform: linux/amd64
    container_name: moviefinder-app-go
    environment:
      STAGE: local
      DATABASE_URL: postgresql://moviefinder-app-go-postgres:moviefinder-app-go-postgres@moviefinder-app-go-postgres:5432/moviefinder-app-go-postgres?sslmode=disable
      PORT: 80
      TMDB_API_READ_ACCESS_TOKEN: ${TMDB_API_READ_ACCESS_TOKEN:-noop}
      TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID:-noop}
      TWILIO_AUTH_TOKEN: ${TWILIO_AUTH_TOKEN:-noop}
      TWILIO_SERVICE_SID: ${TWILIO_SERVICE_SID:-noop}
    ports:
      - "8009:80"
    networks:
      - projects-network
    restart: unless-stopped
    depends_on:
      moviefinder-app-go-postgres:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  moviefinder-app-go-postgres:
    image: postgres:15-alpine
    container_name: moviefinder-app-go-postgres
    environment:
      POSTGRES_DB: moviefinder-app-go-postgres
      POSTGRES_USER: moviefinder-app-go-postgres
      POSTGRES_PASSWORD: moviefinder-app-go-postgres
    ports:
      - "5436:5432"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U moviefinder-app-go-postgres -d moviefinder-app-go-postgres"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 10s

  # Moviefinder App React
  # Source: https://github.com/crvouga/moviefinder.app-react
  moviefinder-app-react:
    image: crvouga/moviefinder-app-react:latest
    platform: linux/amd64
    container_name: moviefinder-app-react
    environment:
      STAGE: local
      PORT: 80
      TMDB_API_READ_ACCESS_TOKEN: ${TMDB_API_READ_ACCESS_TOKEN:-noop}
      TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID:-noop}
      TWILIO_AUTH_TOKEN: ${TWILIO_AUTH_TOKEN:-noop}
      TWILIO_SERVICE_SID: ${TWILIO_SERVICE_SID:-noop}
    ports:
      - "8015:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  # Moviefinder App ClojureScript
  # Source: https://github.com/crvouga/moviefinder.app-clojurescript
  moviefinder-app-clojurescript:
    image: crvouga/moviefinder-app-clojurescript:latest
    platform: linux/amd64
    container_name: moviefinder-app-clojurescript
    environment:
      PORT: 8888
      TMDB_API_READ_ACCESS_TOKEN: ${TMDB_API_READ_ACCESS_TOKEN:-noop}
      TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID:-noop}
      TWILIO_AUTH_TOKEN: ${TWILIO_AUTH_TOKEN:-noop}
      TWILIO_SERVICE_SID: ${TWILIO_SERVICE_SID:-noop}
    ports:
      - "8888:8888"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8888/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  
  # Todo App
  # Source: https://github.com/crvouga/todo-v1
  todo-app:
    image: crvouga/todo-app:latest
    platform: linux/amd64
    container_name: todo-app
    ports:
      - "8010:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Image Service
  # Source: https://github.com/crvouga/image-service
  image-service:
    image: crvouga/image-service:latest
    platform: linux/amd64
    container_name: image-service
    ports:
      - "8008:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Connect Four
  # Source: https://github.com/crvouga/connect-four
  connect-four:
    image: crvouga/connect-four:latest
    platform: linux/amd64
    container_name: connect-four
    ports:
      - "8012:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Screenshot Service
  # Source: https://github.com/crvouga/screenshot-service
  screenshot-service:
    image: crvouga/screenshot-service:latest
    platform: linux/amd64
    container_name: screenshot-service
    ports:
      - "8014:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Anime Blog
  # Source: https://github.com/crvouga/anime
  anime-blog:
    image: crvouga/anime-blog:latest
    platform: linux/amd64
    container_name: anime-blog
    ports:
      - "8011:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Snake Game
  # Source: https://github.com/crvouga/snake
  snake-game:
    image: crvouga/snake-game:latest
    platform: linux/amd64
    container_name: snake-game
    ports:
      - "8013:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Match Three
  # Source: https://github.com/crvouga/match-three
  match-three:
    image: crvouga/match-three:latest
    platform: linux/amd64
    container_name: match-three
    ports:
      - "8016:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Simon Says
  # Source: https://github.com/crvouga/simon-says
  simon-says:
    image: crvouga/simon-says:latest
    platform: linux/amd64
    container_name: simon-says
    ports:
      - "8017:80"
    networks:
      - projects-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Caddy Reverse Proxy
  caddy:
    image: caddy:latest
    container_name: caddy
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    networks:
      - projects-network
    restart: unless-stopped
    depends_on:
      - portfolio
      - pickflix
      - headless-combobox-docs
      - headless-combobox-svelte-example
      - image-service
      - moviefinder-app-rust
      - moviefinder-app-go
      - moviefinder-app-react
      - moviefinder-app-clojurescript
      - todo-app
      - connect-four
      - anime-blog
      - screenshot-service
      - snake-game
      - match-three
      - simon-says

networks:
  projects-network:
    driver: bridge
